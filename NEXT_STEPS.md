# 🚀 次のステップ - 開発ロードマップ

## 📋 現在の状況

✅ **完了済み**
- プロジェクト構造のセットアップ
- Docker設定（開発・本番環境）
- 基本的なAPIエンドポイント（バックエンド）
- 基本的なフロントエンドページ
- 認証システムの基盤
- Prismaスキーマ定義

## 🎯 次のステップ（優先順位順）

### Phase 1: データベースセットアップ（最優先） ⚡

#### 1.1 Supabaseプロジェクト作成
- [ ] Supabaseアカウント作成
- [ ] 新しいプロジェクトを作成
- [ ] プロジェクトURLとAPIキーを取得

#### 1.2 環境変数設定
```bash
# .env ファイルを作成
cp .env.example .env

# 以下の値を設定
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your-service-role-key
SUPABASE_JWT_SECRET=your-jwt-secret
DATABASE_URL=postgresql://postgres:password@db.your-project.supabase.co:5432/postgres
```

#### 1.3 データベースマイグレーション
```bash
cd frontend
npx prisma migrate dev --name init
npx prisma generate
```

#### 1.4 Supabase Auth設定
- [ ] Email認証を有効化
- [ ] Google OAuth設定（必要に応じて）
- [ ] Twitter OAuth設定（必要に応じて）

---

### Phase 2: API連携と動作確認 🔌

#### 2.1 バックエンドAPI動作確認
```bash
# Dockerでバックエンドを起動
make backend

# APIドキュメントを確認
# http://localhost:8000/docs
```

#### 2.2 フロントエンドとバックエンドの接続
- [ ] APIクライアントの動作確認
- [ ] 認証フローの動作確認
- [ ] CORS設定の確認

#### 2.3 テストデータ投入
- [ ] テストユーザー作成
- [ ] サンプルレースデータ作成
- [ ] コインボーナスの動作確認

---

### Phase 3: 予想機能の完全実装 🎯

#### 3.1 予想APIの実装
- [ ] フロントエンドからバックエンドAPIへの接続
- [ ] 予想作成のエラーハンドリング
- [ ] コイン残高のリアルタイム更新

#### 3.2 予想履歴ページ
- [ ] 予想履歴一覧の実装
- [ ] フィルター機能（状態、日付）
- [ ] 予想詳細表示

#### 3.3 バリデーション強化
- [ ] 賭け金の上限チェック
- [ ] レースステータスチェック
- [ ] 予想受付時間チェック

---

### Phase 4: レースデータ取得 📊

#### 4.1 モックデータから開始（推奨）
- [ ] サンプルレースデータの作成
- [ ] レース一覧APIの実装
- [ ] レース詳細APIの実装

#### 4.2 スクレイピング実装（後回し可）
- [ ] JRA公式サイトのスクレイピング
- [ ] オッズデータの取得
- [ ] Celeryタスクの実装

---

### Phase 5: コインシステムの完成 💰

#### 5.1 ボーナス機能の動作確認
- [ ] 新規登録ボーナスの動作確認
- [ ] ログインボーナスの動作確認
- [ ] 連続ログインボーナスの計算確認

#### 5.2 コイン取引履歴
- [ ] 取引履歴ページの実装
- [ ] フィルター機能（種類、期間）
- [ ] 残高の履歴表示

---

### Phase 6: 結果判定・配当計算 🏁

#### 6.1 レース結果取得
- [ ] レース結果データの構造設計
- [ ] 結果取得APIの実装
- [ ] 結果表示ページの実装

#### 6.2 予想結果判定
- [ ] 的中判定ロジックの実装
- [ ] 配当計算ロジックの実装
- [ ] コイン配布の実装

---

## 🛠️ すぐに始められる作業

### 1. Supabaseセットアップ（30分）
```bash
# 1. Supabaseでプロジェクト作成
# https://supabase.com

# 2. 環境変数を設定
cp .env.example .env
# .env を編集

# 3. マイグレーション実行
cd frontend && npx prisma migrate dev
```

### 2. 開発環境の起動（5分）
```bash
# Dockerで全サービスを起動
make dev

# または個別に起動
make frontend  # フロントエンドのみ
make backend   # バックエンドのみ
```

### 3. 動作確認（10分）
- [ ] フロントエンド: http://localhost:3000
- [ ] バックエンドAPI: http://localhost:8000/docs
- [ ] 認証フローのテスト

---

## 📝 チェックリスト

### 最小限の動作確認
- [ ] ユーザー登録ができる
- [ ] ログインができる
- [ ] 新規登録ボーナスが付与される
- [ ] ログインボーナスが付与される
- [ ] レース一覧が表示される
- [ ] 予想が作成できる
- [ ] コイン残高が更新される

---

## 🎯 MVP完成までのマイルストーン

### Milestone 1: 認証とコインシステム ✅
- ユーザー登録・ログイン
- 新規登録ボーナス
- ログインボーナス
- コイン残高管理

### Milestone 2: 予想機能 🎯
- レース一覧表示
- レース詳細表示
- 予想作成
- 予想履歴

### Milestone 3: 結果判定 🏁
- レース結果取得
- 予想結果判定
- 配当計算
- コイン配布

---

## 💡 開発のヒント

1. **まずはモックデータで動作確認**
   - スクレイピングは後回しにして、まずはモックデータで機能を完成させる

2. **段階的に実装**
   - 単勝のみ実装 → 複勝を追加 → その他の予想タイプ

3. **テストを書きながら**
   - 重要な機能（予想作成、配当計算）はテストを書く

4. **エラーハンドリングを重視**
   - ユーザーに分かりやすいエラーメッセージを表示

---

## 📚 参考リソース

- [Supabase ドキュメント](https://supabase.com/docs)
- [Next.js ドキュメント](https://nextjs.org/docs)
- [FastAPI ドキュメント](https://fastapi.tiangolo.com/)
- [Prisma ドキュメント](https://www.prisma.io/docs)

---

**次のアクション**: Supabaseプロジェクトを作成して、環境変数を設定しましょう！🚀


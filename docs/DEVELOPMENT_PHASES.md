# 開発フェーズ詳細

## 開発スケジュール概要

**合計: 約11週間（3ヶ月弱）**

## Phase 1: 基盤構築（2週間）

### 目標
プロジェクトの基盤を構築し、基本的な開発環境を整備します。

### タスク詳細

#### 1.1 Next.jsプロジェクトセットアップ（2日）
- [ ] Next.js最新版プロジェクト作成
- [ ] TypeScript設定
- [ ] ESLint/Prettier設定
- [ ] ディレクトリ構造設計
- [ ] 環境変数設定

#### 1.2 データベース設計・構築（3日）
- [ ] Supabaseプロジェクト作成
- [ ] Prismaセットアップ（TypeScript用）
- [ ] データベーススキーマ設計
- [ ] マイグレーションファイル作成
- [ ] シードデータ作成
- [ ] データベース接続確認

#### 1.3 認証システム実装（3日）
- [ ] Supabase Authセットアップ
- [ ] Supabase JavaScript SDK統合
- [ ] メール認証実装
- [ ] ソーシャルログイン実装（Google, Twitter）
- [ ] ゲストモード実装（ローカルストレージ）
- [ ] 認証ミドルウェア作成

#### 1.4 FastAPIプロジェクトセットアップ（2日）
- [ ] FastAPIプロジェクト作成
- [ ] Python環境設定（Poetry/pipenv）
- [ ] 依存関係インストール
- [ ] Supabase Python SDK統合
- [ ] 認証ミドルウェア実装（JWT検証）
- [ ] CORS設定

#### 1.4 基本的なUIコンポーネント作成（3日）
- [ ] shadcn/uiセットアップ
- [ ] 共通コンポーネント作成（Button, Card, Input等）
- [ ] レイアウトコンポーネント作成
- [ ] ナビゲーションコンポーネント作成
- [ ] レスポンシブデザイン対応

### 成果物
- Next.jsプロジェクト（最新版）
- Supabaseプロジェクト
- データベーススキーマ
- Supabase Auth統合
- FastAPIプロジェクト
- 基本的なUIコンポーネント

## Phase 2: データ取得システム（2週間）

### 目標
外部データソースからレースデータとオッズを取得するシステムを構築します。

### タスク詳細

#### 2.1 スクレイピングシステム構築（Python）（5日）
- [ ] Playwright (Python) セットアップ
- [ ] BeautifulSoup4セットアップ
- [ ] JRA公式サイトのスクレイピング実装
- [ ] オッズデータサイトのスクレイピング実装
- [ ] エラーハンドリング実装
- [ ] リトライ機能実装
- [ ] プロキシローテーション実装（必要に応じて）

#### 2.2 レースデータ取得・保存（3日）
- [ ] レース一覧取得機能（Python）
- [ ] レース詳細取得機能（Python）
- [ ] 出走馬情報取得機能（Python）
- [ ] Supabaseへの保存機能（Python SDK）
- [ ] データ検証機能

#### 2.3 オッズ更新システム（3日）
- [ ] リアルタイムオッズ取得機能（Python）
- [ ] FastAPIエンドポイント作成（オッズ取得）
- [ ] キャッシュ更新機能（Redis）
- [ ] 更新頻度の最適化

#### 2.4 ジョブキュー設定（Celery）（3日）
- [ ] Celeryセットアップ
- [ ] Redis/RabbitMQブローカー設定
- [ ] APScheduler統合
- [ ] 定期ジョブ設定（cron）
  - 毎日5:00: レース一覧取得
  - 5分間隔: オッズ更新
  - レース終了後: 結果取得
- [ ] Celeryワーカー設定
- [ ] ジョブ監視機能（Flower等）
- [ ] エラー通知機能

### 成果物
- スクレイピングシステム
- レースデータ取得・保存機能
- オッズ更新システム
- ジョブキューシステム

## Phase 3: ゲーム機能実装（3週間）

### 目標
コアゲーム機能を実装し、ユーザーが予想できるようにします。

### タスク詳細

#### 3.1 レース一覧・詳細表示（4日）
- [ ] レース一覧ページ作成
- [ ] レース詳細ページ作成
- [ ] フィルター機能実装
- [ ] ソート機能実装
- [ ] ページネーション実装
- [ ] リアルタイム更新機能

#### 3.2 予想機能実装（5日）
- [ ] 予想フォーム作成
- [ ] 予想タイプ選択機能
- [ ] 馬選択機能
- [ ] 賭け金入力機能
- [ ] 予想確認画面
- [ ] 予想確定API実装
- [ ] バリデーション実装

#### 3.3 コインシステム実装（4日）
- [ ] コイン残高表示
- [ ] コイン取引履歴表示
- [ ] コイン獲得機能（予想的中時）
- [ ] コイン消費機能（予想購入時）
- [ ] デイリーボーナス機能
- [ ] ログインボーナス機能
- [ ] 広告視聴ボーナス機能

#### 3.4 結果判定・配当計算（3日）
- [ ] レース結果取得機能
- [ ] 予想結果判定機能
- [ ] 配当計算機能
- [ ] コイン配布機能
- [ ] 結果通知機能

### 成果物
- レース一覧・詳細ページ
- 予想機能
- コインシステム
- 結果判定・配当計算機能

## Phase 4: ランキング・ソーシャル機能（1週間）

### 目標
ランキング機能とソーシャル機能を実装します。

### タスク詳細

#### 4.1 ランキング表示（3日）
- [ ] ランキングページ作成
- [ ] 総資産ランキング実装
- [ ] 収支ランキング実装
- [ ] 的中率ランキング実装
- [ ] 週間/月間ランキング実装
- [ ] リアルタイム更新機能
- [ ] 自分の順位表示機能

#### 4.2 プロフィールページ（2日）
- [ ] プロフィールページ作成
- [ ] ユーザー統計表示
- [ ] 予想履歴表示
- [ ] バッジ表示
- [ ] プロフィール編集機能

#### 4.3 バッジシステム（2日）
- [ ] バッジマスター作成
- [ ] バッジ獲得条件チェック機能
- [ ] バッジ付与機能
- [ ] バッジ表示機能

### 成果物
- ランキングページ
- プロフィールページ
- バッジシステム

## Phase 5: マネタイズ機能（2週間）

### 目標
収益化機能を実装します。

### タスク詳細

#### 5.1 広告統合（3日）
- [ ] Google AdSenseアカウント作成
- [ ] AdSense統合
- [ ] 広告配置箇所の決定
- [ ] ネイティブ広告実装
- [ ] 動画広告実装（インセンティブ付き）
- [ ] 広告視聴履歴管理

#### 5.2 課金システム（Stripe等）（5日）
- [ ] Stripeアカウント作成
- [ ] Stripe統合
- [ ] コイン購入ページ作成
- [ ] 決済フロー実装
- [ ] 決済完了処理
- [ ] コイン付与機能
- [ ] 決済履歴管理
- [ ] レシート送信機能

#### 5.3 サブスクリプション機能（4日）
- [ ] プレミアムプラン設計
- [ ] Stripeサブスクリプション設定
- [ ] サブスクリプション登録機能
- [ ] サブスクリプション管理機能
- [ ] プレミアム機能実装
  - 広告非表示
  - 詳細分析データ
  - 予想上限引き上げ
- [ ] サブスクリプション更新・解約機能

### 成果物
- 広告統合
- 課金システム
- サブスクリプション機能

## Phase 6: 最適化・デプロイ（1週間）

### 目標
パフォーマンス最適化とセキュリティ対策を行い、本番環境にデプロイします。

### タスク詳細

#### 6.1 パフォーマンス最適化（2日）
- [ ] 画像最適化
- [ ] コード分割・遅延読み込み
- [ ] キャッシュ戦略最適化
- [ ] データベースクエリ最適化
- [ ] インデックス最適化
- [ ] バンドルサイズ最適化

#### 6.2 セキュリティ対策（2日）
- [ ] SQLインジェクション対策確認
- [ ] XSS対策確認
- [ ] CSRF対策確認
- [ ] レート制限実装
- [ ] 入力バリデーション強化
- [ ] セキュリティヘッダー設定
- [ ] 脆弱性スキャン

#### 6.3 本番環境デプロイ（2日）
- [ ] 本番環境設定
- [ ] 環境変数設定
  - Next.js環境変数（Vercel）
  - FastAPI環境変数（Railway/Render）
  - Supabase環境変数
- [ ] データベース移行（Supabase）
- [ ] Vercelデプロイ（Next.js）
- [ ] Railway/Renderデプロイ（FastAPI）
- [ ] Celeryワーカーデプロイ
- [ ] ドメイン設定
- [ ] SSL証明書設定
- [ ] モニタリング設定
  - Vercel Analytics
  - FastAPIログ監視
  - Celery監視（Flower）

#### 6.4 テスト・品質保証（1日）
- [ ] 統合テスト
- [ ] E2Eテスト
- [ ] パフォーマンステスト
- [ ] セキュリティテスト
- [ ] ユーザー受け入れテスト

### 成果物
- 最適化されたアプリケーション
- セキュリティ対策済みアプリケーション
- 本番環境デプロイ完了

## 開発プロセス

### バージョン管理
- **Git**: メインブランチ + 機能ブランチ
- **ブランチ戦略**: Git Flow
- **コミットメッセージ**: Conventional Commits

### コードレビュー
- すべてのPRはレビュー必須
- 最低1名の承認が必要

### テスト
- **単体テスト**: Jest + React Testing Library
- **統合テスト**: 主要フロー
- **E2Eテスト**: Playwright

### デプロイ
- **Next.js（Vercel）**:
  - 開発環境: 自動デプロイ（mainブランチ）
  - 本番環境: 手動デプロイ（承認後）
- **FastAPI（Railway/Render）**:
  - 開発環境: 自動デプロイ（mainブランチ）
  - 本番環境: 手動デプロイ（承認後）
- **Celeryワーカー**:
  - 開発環境: ローカル実行
  - 本番環境: Railway/Renderで実行

## リスク管理

### 技術的リスク
- **スクレイピング失敗**: バックアップデータソースの確保
- **パフォーマンス問題**: 早期の負荷テスト

### スケジュールリスク
- **遅延**: バッファ期間を設ける
- **優先順位**: MVP機能を優先

## 次のステップ（Phase 7以降）

### 機能拡張
- ソーシャル機能（フォロー、コメント）
- 予想共有機能
- レース予想AI機能
- モバイルアプリ

### 最適化
- A/Bテスト
- パーソナライゼーション
- リコメンデーション機能

